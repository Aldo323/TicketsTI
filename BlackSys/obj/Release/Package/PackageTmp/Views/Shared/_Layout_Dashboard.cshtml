@using Microsoft.AspNet.Identity
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />


    <title>@ViewBag.Title - Tickets</title>
    @Html.Hidden("Get", Url.Action("Get", "Notification"))
    @**@
    <!--STYLES-->
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700&subset=all" rel="stylesheet" type="text/css" />
    @Styles.Render("~/Content/font-awensome")
    @Styles.Render("~/Content/simple-icons")
    @Styles.Render("~/Content/bootstrap")
    @Styles.Render("~/Content/uniform")
    @Styles.Render("~/Content/bootstrap-switch")
    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN THEME STYLES -->
    <link href="~/Content/plugins/datatables/datatables.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css" rel="stylesheet" type="text/css" />

    <link href="~/Content/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/plugins/select2/css/select2-bootstrap.min.css" rel="stylesheet" type="text/css" />

    <link href="~/Content/plugins/bootstrap-toastr/toastr.min.css" rel="stylesheet" type="text/css" />

    <link href="~/Content/template/css/components.css" id="style_components" rel="stylesheet" type="text/css" />
    <link href="~/Content/template/css/plugins.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/template/layout/css/layout.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/template/layout/css/themes/darkblue.css" rel="stylesheet" type="text/css" id="style_color" />
    <link href="~/Content/template/layout/css/custom.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/plugins/icheck/skins/all.css" rel="stylesheet" stylesheet" type="text/css" />
    <link href="~/Content/css/Custom.css" rel="stylesheet" type="text/css" />
    <!-- END THEME STYLES -->
    <link rel="shortcut icon" href="favicon.ico" />
    <!--SCRIPTS-->
    @Scripts.Render("~/bundles/jquery")
</head>
<body class="page-header-fixed page-sidebar-closed-hide-logo page-content-white">
    @RenderSection("topLevel", required: false)
    <!--HEADER-->
    <div class="page-header navbar navbar-fixed-top">
        <div class="page-header-inner">
            <div class="page-logo">
                <a href="/">
                    <img src="https://docs.google.com/drawings/d/e/2PACX-1vS0mVUzZoLqaiJn-otvI_WeNtOQUF873o40pDLwdelsDwjHcKAb5NUE0eCthy79sHj77xnNLZCa7PCr/pub?w=132&h=100" style="width: 64px;margin-left: 51px;">
                </a>
                <div class="menu-toggler sidebar-toggler"> </div>
            </div>
            <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse" data-target=".navbar-collapse"> </a>
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    @Html.Partial("_LoginPartial")
                </ul>
            </div>
        </div>
    </div>

    <div class="clearfix">


    </div>
    <!--BODY-->
    <div class="page-container">
        <div class="page-sidebar-wrapper">
            <div class="page-sidebar navbar-collapse collapse">
                <ul class="page-sidebar-menu  page-header-fixed " data-keep-expanded="false" data-auto-scroll="true" data-slide-speed="200" style="padding-top: 20px">
                    <li class="sidebar-toggler-wrapper hide">
                        <div class="sidebar-toggler"> </div>

                    </li>
                    <li class="heading">
                        <h3 class="uppercase">Menu</h3>
                    </li>
                    <li class="nav-item start active open">
                        <a href="@System.Configuration.ConfigurationManager.AppSettings["home_icon"]" class="nav-link nav-toggle">
                            <i class="icon-home"></i>
                            <span class="title">Inicio</span>
                            <span class="selected"></span>
                        </a>
                    </li>

                    @{Html.RenderAction("LoadMenu", "Home");}
                </ul>
            </div>
        </div>
        <div class="page-content-wrapper">
            <div class="page-content">


                <div class="page-bar">
                    <ul class="page-breadcrumb">

 
                        <li>
                            <input type="text" align="center" placeholder="Buscar.." id="search_text" style="height: 40px;width:250px;padding-top: 16px;">
                        </li>
                      
                    </ul>
                    <div class="page-toolbar">
                    </div>
                </div>
                @RenderSection("featured", required: false)
                @RenderBody()
            </div>
        </div>
        <!--MODAL-->
        <div class="modal fade" id="basic" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                        <h4 class="modal-title">Modal Title</h4>
                    </div>
                    <div class="modal-body"> Modal body goes here </div>
                    <div class="modal-footer">
                        <button type="button" class="btn dark btn-outline" data-dismiss="modal">Close</button>
                        <button type="button" class="btn green">Save changes</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>

            <!-- /.modal-dialog -->
        </div>
    </div>
    <!--SCRIPTS-->
    @*<script src="~/Scripts/jquery-3.3.1.js"></script>*@

    @Scripts.Render("~/bundles/jquery-migrate")
    @Scripts.Render("~/bundles/jquery-ui")
    @Scripts.Render("~/bundles/bootstrap")
    @Scripts.Render("~/bundles/jquery-plugins")
    @Scripts.Render("~/bundles/template")

    <!-- Style CSS-->
    <style type="text/css">
        /*Added css for design notification area, you can design by your self*/
        /* COPY css content from youtube video description*/
        .noti-content {
            position: fixed;
            right: 100px;
            background: #36c6d3;
            top: 47px;
            width: 250px;
            display: none;
            border: 1px solid #337ab7;
            /*border-radius: 6px !important;*/
        }

        #noticontentrow {
            position: static;
        }

        ul#notiContent {
            max-height: 200px;
            overflow: auto;
            padding: 0px;
            margin: 0px;
            padding-left: 20px;
            color: #ffffff;
        }

            ul#notiContent li {
                margin: 3px;
                padding: 6px;
                background: #fff;
                border-radius: 4px !important;
            }

        .noti-top-arrow {
            border-color: transparent;
            border-bottom-color: #F5DEB3;
            border-style: dashed dashed solid;
            border-width: 0 8.5px 8.5px;
            position: absolute;
            right: 32px;
            top: -8px;
        }

        #bell {
            position: static;
        }

        #userpicturec {
            padding-top: 0px;
            border-top-width: 21px;
            margin-top: -11px;
        }

        span.noti {
            color: #54b4f9;
            margin: 16px;
            position: fixed;
            right: 272px;
            font-size: 19px;
            cursor: pointer;
        }

        span.count {
            position: relative;
            top: -3px;
        }
    </style>

    @{Html.RenderPartial("_RenderConfirm.js");}

    <audio id="audio-alert" src="~/Content/audio/alert.mp3" preload="auto"></audio>
    <audio id="audio-fail" src="~/Content/audio/fail.mp3" preload="auto"></audio>

    <script src="~/Content/plugins/select2/js/select2.full.min.js" type="text/javascript"></script>
    <script src="~/Content/plugins/icheck/icheck.js" type="text/javascript"></script>
    <script src="~/Content/plugins/bootbox/bootbox.min.js" type="text/javascript"></script>
    <script src="~/Content/plugins/bootstrap-toastr/toastr.min.js" type="text/javascript"></script>



    @RenderSection("Scripts", required: false)
    <script src="~/Content/js/BlackSys.js" type="text/javascript"></script>

    <script src="~/Scripts/jquery.signalR-2.4.1.js"></script>
    <script src="@System.Configuration.ConfigurationManager.AppSettings["Request"]/signalr/hubs"></script>

    <script type="text/javascript">
        $(function () {
             var msg = '@TempData["ResultMessage"]';
             var msgType = '@TempData["ResultType"]';
             showNotification(msg, msgType);


            // Click on notification icon for show notification
            $('span.noti').click(function (e) {
                e.stopPropagation();
                $('.noti-content').show();
                var count = 0;
                count = parseInt($('span.count').html()) || 0;
                //only load notification if not already loaded
               // if (count > 0) {
                    updateNotification();
               // }
                $('span.count', this).html('&nbsp;');
            })


            // hide notifications
            $('html').click(function () {
                $('.noti-content').hide();
            })


            var notificationHub = $.connection.notificationHub;
            // update notification
            function updateNotification() {
                $('#notiContent').empty();
                $('#notiContent').append($('<li>Loading...</li>'));

                $.ajax({
                    type: 'GET',
                    url: '/api/bellnotes',
                    success: function (Informe) {
                        //console.log(Informe.Informe[1].Email)
                        //console.log(Informe.Informe.length)
                        $('#notiContent').empty();
                        if (Informe.length == 0) {
                $('#notiContent').append($('<li>No data available</li>'));
                        }
                        var count = 0;
                $.each(Informe, function (index, value) {
                     for (var i = 0; i <= value.length; i++)
                        {


                    //$('#notiContent').append($('<li>Se ha comentado el ticket #:' + value.Informe + ''));

                            $('#notiContent').append($('<li><a href="@System.Configuration.ConfigurationManager.AppSettings["Request"]/Mensajes/Create/' + value[i].idSolicitud + '"><b>' + value[i].Nombre + '</b> ' + value[i].Notify +"  :" +value[i].idSolicitud+ '</a></li>'));
                   // console.log(value.length)

                     }
                });
                    },
                    error: function (error) {
                        console.log(error)
                    }
                })
            }

            //update notification count
            function updateNotificationCount() {
                var count = 0;
                count = parseInt($('span.count').html()) || 0;
                count++;
                $('span.count').html(count);
            }

            var connec = $.hubConnection();

  
            var conexion = $.connection.hub.id;

            $.connection.hub.start().done(function () {

       
                console.log(notificationHub.connection.id);
                console.log('Notification hub started');
       
            });


            //signalr method for push server message to client
            notificationHub.client.notify = function (message) {

                updateNotificationCount()
                    $.ajax({
                        url: '@System.Configuration.ConfigurationManager.AppSettings["Request"]/api/user',
                        dataType: 'json',
                        contentType: 'application/json; charset=utf-8',
                        success: function (response) {
                            if (response.usuario == message) {
                             console.log('Zavala');


                                //TempData["ResultMessage"] = "El archivo no es una imagen";
                            }
                            else {
                                 console.log('Moreno');
                            }

                        },
                        error: function (error) {
                            console.log(error);
                        }
                    })




            }

        })
    </script>
</body>
</html>
